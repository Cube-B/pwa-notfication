--
-- PostgreSQL database dump
--

-- Dumped from database version 16.10 (Homebrew)
-- Dumped by pg_dump version 17.0

-- Started on 2025-12-23 02:59:13 +07

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET transaction_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

SET default_tablespace = '';

SET default_table_access_method = heap;

--
-- TOC entry 220 (class 1259 OID 16799)
-- Name: notification_deliveries; Type: TABLE; Schema: public; Owner: privatoffy
--

CREATE TABLE public.notification_deliveries (
    id integer NOT NULL,
    notification_id integer,
    subscription_id integer,
    delivered boolean DEFAULT false,
    delivered_at timestamp without time zone,
    error_message text
);


ALTER TABLE public.notification_deliveries OWNER TO privatoffy;

--
-- TOC entry 219 (class 1259 OID 16798)
-- Name: notification_deliveries_id_seq; Type: SEQUENCE; Schema: public; Owner: privatoffy
--

CREATE SEQUENCE public.notification_deliveries_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.notification_deliveries_id_seq OWNER TO privatoffy;

--
-- TOC entry 3841 (class 0 OID 0)
-- Dependencies: 219
-- Name: notification_deliveries_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: privatoffy
--

ALTER SEQUENCE public.notification_deliveries_id_seq OWNED BY public.notification_deliveries.id;


--
-- TOC entry 218 (class 1259 OID 16786)
-- Name: notifications_history; Type: TABLE; Schema: public; Owner: privatoffy
--

CREATE TABLE public.notifications_history (
    id integer NOT NULL,
    title text NOT NULL,
    body text NOT NULL,
    icon text,
    url text,
    data jsonb,
    sent_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    expires_at timestamp without time zone DEFAULT (CURRENT_TIMESTAMP + '7 days'::interval)
);


ALTER TABLE public.notifications_history OWNER TO privatoffy;

--
-- TOC entry 217 (class 1259 OID 16785)
-- Name: notifications_history_id_seq; Type: SEQUENCE; Schema: public; Owner: privatoffy
--

CREATE SEQUENCE public.notifications_history_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.notifications_history_id_seq OWNER TO privatoffy;

--
-- TOC entry 3842 (class 0 OID 0)
-- Dependencies: 217
-- Name: notifications_history_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: privatoffy
--

ALTER SEQUENCE public.notifications_history_id_seq OWNED BY public.notifications_history.id;


--
-- TOC entry 216 (class 1259 OID 16773)
-- Name: subscriptions; Type: TABLE; Schema: public; Owner: privatoffy
--

CREATE TABLE public.subscriptions (
    id integer NOT NULL,
    endpoint text NOT NULL,
    keys_p256dh text NOT NULL,
    keys_auth text NOT NULL,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    last_notification timestamp without time zone,
    active boolean DEFAULT true,
    carrier text,
    carrier_ip text,
    carrier_location text,
    device_type text,
    is_mobile_network boolean DEFAULT false,
    has_mobile_carrier boolean DEFAULT false,
    detection_method text,
    carrier_detected_at timestamp without time zone,
    last_carrier_check timestamp without time zone
);


ALTER TABLE public.subscriptions OWNER TO privatoffy;

--
-- TOC entry 3843 (class 0 OID 0)
-- Dependencies: 216
-- Name: COLUMN subscriptions.carrier; Type: COMMENT; Schema: public; Owner: privatoffy
--

COMMENT ON COLUMN public.subscriptions.carrier IS 'Network carrier name (AIS, DTAC, True, etc)';


--
-- TOC entry 3844 (class 0 OID 0)
-- Dependencies: 216
-- Name: COLUMN subscriptions.carrier_ip; Type: COMMENT; Schema: public; Owner: privatoffy
--

COMMENT ON COLUMN public.subscriptions.carrier_ip IS 'IP address when carrier was detected';


--
-- TOC entry 3845 (class 0 OID 0)
-- Dependencies: 216
-- Name: COLUMN subscriptions.carrier_location; Type: COMMENT; Schema: public; Owner: privatoffy
--

COMMENT ON COLUMN public.subscriptions.carrier_location IS 'Location when carrier was detected';


--
-- TOC entry 3846 (class 0 OID 0)
-- Dependencies: 216
-- Name: COLUMN subscriptions.device_type; Type: COMMENT; Schema: public; Owner: privatoffy
--

COMMENT ON COLUMN public.subscriptions.device_type IS 'Device type (iOS, Android, etc)';


--
-- TOC entry 3847 (class 0 OID 0)
-- Dependencies: 216
-- Name: COLUMN subscriptions.is_mobile_network; Type: COMMENT; Schema: public; Owner: privatoffy
--

COMMENT ON COLUMN public.subscriptions.is_mobile_network IS 'True if detected on mobile network (not WiFi)';


--
-- TOC entry 3848 (class 0 OID 0)
-- Dependencies: 216
-- Name: COLUMN subscriptions.has_mobile_carrier; Type: COMMENT; Schema: public; Owner: privatoffy
--

COMMENT ON COLUMN public.subscriptions.has_mobile_carrier IS 'True if mobile carrier has been detected (stop collecting)';


--
-- TOC entry 3849 (class 0 OID 0)
-- Dependencies: 216
-- Name: COLUMN subscriptions.detection_method; Type: COMMENT; Schema: public; Owner: privatoffy
--

COMMENT ON COLUMN public.subscriptions.detection_method IS 'Method used (sim_api, ip_geo)';


--
-- TOC entry 3850 (class 0 OID 0)
-- Dependencies: 216
-- Name: COLUMN subscriptions.carrier_detected_at; Type: COMMENT; Schema: public; Owner: privatoffy
--

COMMENT ON COLUMN public.subscriptions.carrier_detected_at IS 'When mobile carrier was first detected';


--
-- TOC entry 3851 (class 0 OID 0)
-- Dependencies: 216
-- Name: COLUMN subscriptions.last_carrier_check; Type: COMMENT; Schema: public; Owner: privatoffy
--

COMMENT ON COLUMN public.subscriptions.last_carrier_check IS 'Last time carrier detection was attempted';


--
-- TOC entry 215 (class 1259 OID 16772)
-- Name: subscriptions_id_seq; Type: SEQUENCE; Schema: public; Owner: privatoffy
--

CREATE SEQUENCE public.subscriptions_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.subscriptions_id_seq OWNER TO privatoffy;

--
-- TOC entry 3852 (class 0 OID 0)
-- Dependencies: 215
-- Name: subscriptions_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: privatoffy
--

ALTER SEQUENCE public.subscriptions_id_seq OWNED BY public.subscriptions.id;


--
-- TOC entry 3666 (class 2604 OID 16802)
-- Name: notification_deliveries id; Type: DEFAULT; Schema: public; Owner: privatoffy
--

ALTER TABLE ONLY public.notification_deliveries ALTER COLUMN id SET DEFAULT nextval('public.notification_deliveries_id_seq'::regclass);


--
-- TOC entry 3663 (class 2604 OID 16789)
-- Name: notifications_history id; Type: DEFAULT; Schema: public; Owner: privatoffy
--

ALTER TABLE ONLY public.notifications_history ALTER COLUMN id SET DEFAULT nextval('public.notifications_history_id_seq'::regclass);


--
-- TOC entry 3658 (class 2604 OID 16776)
-- Name: subscriptions id; Type: DEFAULT; Schema: public; Owner: privatoffy
--

ALTER TABLE ONLY public.subscriptions ALTER COLUMN id SET DEFAULT nextval('public.subscriptions_id_seq'::regclass);


--
-- TOC entry 3835 (class 0 OID 16799)
-- Dependencies: 220
-- Data for Name: notification_deliveries; Type: TABLE DATA; Schema: public; Owner: privatoffy
--

COPY public.notification_deliveries (id, notification_id, subscription_id, delivered, delivered_at, error_message) FROM stdin;
6	7	20	f	\N	Received unexpected response code
7	7	21	t	2025-12-23 02:12:17.442337	\N
8	8	21	t	2025-12-23 02:51:49.721127	\N
\.


--
-- TOC entry 3833 (class 0 OID 16786)
-- Dependencies: 218
-- Data for Name: notifications_history; Type: TABLE DATA; Schema: public; Owner: privatoffy
--

COPY public.notifications_history (id, title, body, icon, url, data, sent_at, expires_at) FROM stdin;
2	ðŸ”¥ Test à¸žà¸±à¸š	à¸—à¸”à¸ªà¸­à¸š notification	/logo.png	https://1klive.com	{"timestamp": 1766259256689}	2025-12-21 02:34:16.713213	2025-12-28 02:34:16.713213
3	ðŸ”¥ Test à¸žà¸±à¸š	à¸—à¸”à¸ªà¸­à¸š notification	/logo.png	https://1klive.com	{"timestamp": 1766259304743}	2025-12-21 02:35:04.84407	2025-12-28 02:35:04.84407
4	ðŸ”¥ Test à¸žà¸±à¸š	à¸—à¸”à¸ªà¸­à¸š notification	/logo.png	https://1klive.com	{"timestamp": 1766259709406}	2025-12-21 02:41:49.489545	2025-12-28 02:41:49.489545
5	ðŸ”¥ Test à¸žà¸±à¸š	à¸—à¸”à¸ªà¸­à¸š notification	/logo.png	https://1klive.com	{"timestamp": 1766259832813}	2025-12-21 02:43:52.836741	2025-12-28 02:43:52.836741
6	ðŸ”¥ Test à¸žà¸±à¸š	à¸—à¸”à¸ªà¸­à¸š notification	/logo.png	https://1klive.com	{"timestamp": 1766259863453}	2025-12-21 02:44:23.468068	2025-12-28 02:44:23.468068
7	ðŸ”¥ Test à¸žà¸±à¸š	à¸—à¸”à¸ªà¸­à¸š notification	/logo.png	https://1klive.com	{"timestamp": 1766430737184}	2025-12-23 02:12:17.211786	2025-12-30 02:12:17.211786
8	ðŸ”¥ Test à¸žà¸±à¸š	à¸—à¸”à¸ªà¸­à¸š notification	/logo.png	https://1klive.com	{"timestamp": 1766433109341}	2025-12-23 02:51:49.375239	2025-12-30 02:51:49.375239
\.


--
-- TOC entry 3831 (class 0 OID 16773)
-- Dependencies: 216
-- Data for Name: subscriptions; Type: TABLE DATA; Schema: public; Owner: privatoffy
--

COPY public.subscriptions (id, endpoint, keys_p256dh, keys_auth, created_at, last_notification, active, carrier, carrier_ip, carrier_location, device_type, is_mobile_network, has_mobile_carrier, detection_method, carrier_detected_at, last_carrier_check) FROM stdin;
20	https://fcm.googleapis.com/fcm/send/cbMorE0iPjQ:APA91bFuegChFXtXatBU-1w8Jp-lI-OFoaaXHis0fR_98Rhj4Mi1kyLESTwXbUyo_ffuVD2qxl-vyjkx7e0tOL2wteyataLnUJq3cMLoQK-2iNu7cb_qEbvXZPu0WjvyllmWAS5zEen6	BOz0pwfkQOfC0u3E6e_gp24iokQVK0-22LaecMIle1rtWrMdY0iOhYbO98_W0dbrctyCEgPjcz53BHupJQZmBR4	0NjeBWBNUDQ4amPdRxI5hg	2025-12-23 02:11:19.635849	2025-12-23 02:11:19.880242	f	\N	\N	\N	\N	f	f	\N	\N	\N
21	https://fcm.googleapis.com/fcm/send/dNTksvsWRyU:APA91bEvxITqoZ1H2yL_2oZ6B8YSKaYNx86u2LqTetlAp5kbxHnGPl_WBsXGTUKl0ASyz4tIF49DQcjvuwepQmP6QsfQAB_RWxnOx6dBQgWNtQtGnMAc3iamR6b6ZMEheDDlmhlnUiZX	BLu5Pj-55wzxKnjXTRKqI_Si59-v55TbHZaZBNA39mbvVz915uHdQvGQS1iE2oA9uij4l7W0UKJ3o7kn1QKxTnk	ByCy_V9gERsQp5WumDMErA	2025-12-23 02:11:45.698836	2025-12-23 02:51:49.710594	t	\N	\N	\N	\N	f	f	\N	\N	\N
\.


--
-- TOC entry 3853 (class 0 OID 0)
-- Dependencies: 219
-- Name: notification_deliveries_id_seq; Type: SEQUENCE SET; Schema: public; Owner: privatoffy
--

SELECT pg_catalog.setval('public.notification_deliveries_id_seq', 8, true);


--
-- TOC entry 3854 (class 0 OID 0)
-- Dependencies: 217
-- Name: notifications_history_id_seq; Type: SEQUENCE SET; Schema: public; Owner: privatoffy
--

SELECT pg_catalog.setval('public.notifications_history_id_seq', 8, true);


--
-- TOC entry 3855 (class 0 OID 0)
-- Dependencies: 215
-- Name: subscriptions_id_seq; Type: SEQUENCE SET; Schema: public; Owner: privatoffy
--

SELECT pg_catalog.setval('public.subscriptions_id_seq', 21, true);


--
-- TOC entry 3682 (class 2606 OID 16809)
-- Name: notification_deliveries notification_deliveries_notification_id_subscription_id_key; Type: CONSTRAINT; Schema: public; Owner: privatoffy
--

ALTER TABLE ONLY public.notification_deliveries
    ADD CONSTRAINT notification_deliveries_notification_id_subscription_id_key UNIQUE (notification_id, subscription_id);


--
-- TOC entry 3684 (class 2606 OID 16807)
-- Name: notification_deliveries notification_deliveries_pkey; Type: CONSTRAINT; Schema: public; Owner: privatoffy
--

ALTER TABLE ONLY public.notification_deliveries
    ADD CONSTRAINT notification_deliveries_pkey PRIMARY KEY (id);


--
-- TOC entry 3677 (class 2606 OID 16795)
-- Name: notifications_history notifications_history_pkey; Type: CONSTRAINT; Schema: public; Owner: privatoffy
--

ALTER TABLE ONLY public.notifications_history
    ADD CONSTRAINT notifications_history_pkey PRIMARY KEY (id);


--
-- TOC entry 3671 (class 2606 OID 16784)
-- Name: subscriptions subscriptions_endpoint_key; Type: CONSTRAINT; Schema: public; Owner: privatoffy
--

ALTER TABLE ONLY public.subscriptions
    ADD CONSTRAINT subscriptions_endpoint_key UNIQUE (endpoint);


--
-- TOC entry 3673 (class 2606 OID 16782)
-- Name: subscriptions subscriptions_pkey; Type: CONSTRAINT; Schema: public; Owner: privatoffy
--

ALTER TABLE ONLY public.subscriptions
    ADD CONSTRAINT subscriptions_pkey PRIMARY KEY (id);


--
-- TOC entry 3678 (class 1259 OID 16822)
-- Name: idx_deliveries_delivered; Type: INDEX; Schema: public; Owner: privatoffy
--

CREATE INDEX idx_deliveries_delivered ON public.notification_deliveries USING btree (delivered, delivered_at);


--
-- TOC entry 3679 (class 1259 OID 16820)
-- Name: idx_deliveries_notification; Type: INDEX; Schema: public; Owner: privatoffy
--

CREATE INDEX idx_deliveries_notification ON public.notification_deliveries USING btree (notification_id);


--
-- TOC entry 3680 (class 1259 OID 16821)
-- Name: idx_deliveries_subscription; Type: INDEX; Schema: public; Owner: privatoffy
--

CREATE INDEX idx_deliveries_subscription ON public.notification_deliveries USING btree (subscription_id);


--
-- TOC entry 3674 (class 1259 OID 16796)
-- Name: idx_notifications_expires; Type: INDEX; Schema: public; Owner: privatoffy
--

CREATE INDEX idx_notifications_expires ON public.notifications_history USING btree (expires_at);


--
-- TOC entry 3675 (class 1259 OID 16797)
-- Name: idx_notifications_sent; Type: INDEX; Schema: public; Owner: privatoffy
--

CREATE INDEX idx_notifications_sent ON public.notifications_history USING btree (sent_at DESC);


--
-- TOC entry 3668 (class 1259 OID 16825)
-- Name: idx_subscriptions_carrier; Type: INDEX; Schema: public; Owner: privatoffy
--

CREATE INDEX idx_subscriptions_carrier ON public.subscriptions USING btree (carrier);


--
-- TOC entry 3669 (class 1259 OID 16826)
-- Name: idx_subscriptions_mobile_carrier; Type: INDEX; Schema: public; Owner: privatoffy
--

CREATE INDEX idx_subscriptions_mobile_carrier ON public.subscriptions USING btree (has_mobile_carrier);


--
-- TOC entry 3685 (class 2606 OID 16810)
-- Name: notification_deliveries notification_deliveries_notification_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: privatoffy
--

ALTER TABLE ONLY public.notification_deliveries
    ADD CONSTRAINT notification_deliveries_notification_id_fkey FOREIGN KEY (notification_id) REFERENCES public.notifications_history(id) ON DELETE CASCADE;


--
-- TOC entry 3686 (class 2606 OID 16815)
-- Name: notification_deliveries notification_deliveries_subscription_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: privatoffy
--

ALTER TABLE ONLY public.notification_deliveries
    ADD CONSTRAINT notification_deliveries_subscription_id_fkey FOREIGN KEY (subscription_id) REFERENCES public.subscriptions(id) ON DELETE CASCADE;


-- Completed on 2025-12-23 02:59:13 +07

--
-- PostgreSQL database dump complete
--

