--
-- PostgreSQL database dump
--

-- Dumped from database version 16.10 (Homebrew)
-- Dumped by pg_dump version 17.0

-- Started on 2025-12-22 23:22:06 +07

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET transaction_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

SET default_tablespace = '';

SET default_table_access_method = heap;

--
-- TOC entry 220 (class 1259 OID 16799)
-- Name: notification_deliveries; Type: TABLE; Schema: public; Owner: privatoffy
--

CREATE TABLE public.notification_deliveries (
    id integer NOT NULL,
    notification_id integer,
    subscription_id integer,
    delivered boolean DEFAULT false,
    delivered_at timestamp without time zone,
    error_message text
);


ALTER TABLE public.notification_deliveries OWNER TO privatoffy;

--
-- TOC entry 219 (class 1259 OID 16798)
-- Name: notification_deliveries_id_seq; Type: SEQUENCE; Schema: public; Owner: privatoffy
--

CREATE SEQUENCE public.notification_deliveries_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.notification_deliveries_id_seq OWNER TO privatoffy;

--
-- TOC entry 3837 (class 0 OID 0)
-- Dependencies: 219
-- Name: notification_deliveries_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: privatoffy
--

ALTER SEQUENCE public.notification_deliveries_id_seq OWNED BY public.notification_deliveries.id;


--
-- TOC entry 218 (class 1259 OID 16786)
-- Name: notifications_history; Type: TABLE; Schema: public; Owner: privatoffy
--

CREATE TABLE public.notifications_history (
    id integer NOT NULL,
    title text NOT NULL,
    body text NOT NULL,
    icon text,
    url text,
    data jsonb,
    sent_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    expires_at timestamp without time zone DEFAULT (CURRENT_TIMESTAMP + '7 days'::interval)
);


ALTER TABLE public.notifications_history OWNER TO privatoffy;

--
-- TOC entry 217 (class 1259 OID 16785)
-- Name: notifications_history_id_seq; Type: SEQUENCE; Schema: public; Owner: privatoffy
--

CREATE SEQUENCE public.notifications_history_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.notifications_history_id_seq OWNER TO privatoffy;

--
-- TOC entry 3838 (class 0 OID 0)
-- Dependencies: 217
-- Name: notifications_history_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: privatoffy
--

ALTER SEQUENCE public.notifications_history_id_seq OWNED BY public.notifications_history.id;


--
-- TOC entry 216 (class 1259 OID 16773)
-- Name: subscriptions; Type: TABLE; Schema: public; Owner: privatoffy
--

CREATE TABLE public.subscriptions (
    id integer NOT NULL,
    endpoint text NOT NULL,
    keys_p256dh text NOT NULL,
    keys_auth text NOT NULL,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    last_notification timestamp without time zone,
    active boolean DEFAULT true
);


ALTER TABLE public.subscriptions OWNER TO privatoffy;

--
-- TOC entry 215 (class 1259 OID 16772)
-- Name: subscriptions_id_seq; Type: SEQUENCE; Schema: public; Owner: privatoffy
--

CREATE SEQUENCE public.subscriptions_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.subscriptions_id_seq OWNER TO privatoffy;

--
-- TOC entry 3839 (class 0 OID 0)
-- Dependencies: 215
-- Name: subscriptions_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: privatoffy
--

ALTER SEQUENCE public.subscriptions_id_seq OWNED BY public.subscriptions.id;


--
-- TOC entry 3664 (class 2604 OID 16802)
-- Name: notification_deliveries id; Type: DEFAULT; Schema: public; Owner: privatoffy
--

ALTER TABLE ONLY public.notification_deliveries ALTER COLUMN id SET DEFAULT nextval('public.notification_deliveries_id_seq'::regclass);


--
-- TOC entry 3661 (class 2604 OID 16789)
-- Name: notifications_history id; Type: DEFAULT; Schema: public; Owner: privatoffy
--

ALTER TABLE ONLY public.notifications_history ALTER COLUMN id SET DEFAULT nextval('public.notifications_history_id_seq'::regclass);


--
-- TOC entry 3658 (class 2604 OID 16776)
-- Name: subscriptions id; Type: DEFAULT; Schema: public; Owner: privatoffy
--

ALTER TABLE ONLY public.subscriptions ALTER COLUMN id SET DEFAULT nextval('public.subscriptions_id_seq'::regclass);


--
-- TOC entry 3831 (class 0 OID 16799)
-- Dependencies: 220
-- Data for Name: notification_deliveries; Type: TABLE DATA; Schema: public; Owner: privatoffy
--

COPY public.notification_deliveries (id, notification_id, subscription_id, delivered, delivered_at, error_message) FROM stdin;
1	2	16	t	2025-12-21 02:34:17.082008	\N
2	3	16	t	2025-12-21 02:35:05.099805	\N
3	4	16	t	2025-12-21 02:41:49.749536	\N
4	5	16	t	2025-12-21 02:43:53.132398	\N
5	6	16	t	2025-12-21 02:44:23.639044	\N
\.


--
-- TOC entry 3829 (class 0 OID 16786)
-- Dependencies: 218
-- Data for Name: notifications_history; Type: TABLE DATA; Schema: public; Owner: privatoffy
--

COPY public.notifications_history (id, title, body, icon, url, data, sent_at, expires_at) FROM stdin;
2	ðŸ”¥ Test à¸žà¸±à¸š	à¸—à¸”à¸ªà¸­à¸š notification	/logo.png	https://1klive.com	{"timestamp": 1766259256689}	2025-12-21 02:34:16.713213	2025-12-28 02:34:16.713213
3	ðŸ”¥ Test à¸žà¸±à¸š	à¸—à¸”à¸ªà¸­à¸š notification	/logo.png	https://1klive.com	{"timestamp": 1766259304743}	2025-12-21 02:35:04.84407	2025-12-28 02:35:04.84407
4	ðŸ”¥ Test à¸žà¸±à¸š	à¸—à¸”à¸ªà¸­à¸š notification	/logo.png	https://1klive.com	{"timestamp": 1766259709406}	2025-12-21 02:41:49.489545	2025-12-28 02:41:49.489545
5	ðŸ”¥ Test à¸žà¸±à¸š	à¸—à¸”à¸ªà¸­à¸š notification	/logo.png	https://1klive.com	{"timestamp": 1766259832813}	2025-12-21 02:43:52.836741	2025-12-28 02:43:52.836741
6	ðŸ”¥ Test à¸žà¸±à¸š	à¸—à¸”à¸ªà¸­à¸š notification	/logo.png	https://1klive.com	{"timestamp": 1766259863453}	2025-12-21 02:44:23.468068	2025-12-28 02:44:23.468068
\.


--
-- TOC entry 3827 (class 0 OID 16773)
-- Dependencies: 216
-- Data for Name: subscriptions; Type: TABLE DATA; Schema: public; Owner: privatoffy
--

COPY public.subscriptions (id, endpoint, keys_p256dh, keys_auth, created_at, last_notification, active) FROM stdin;
15	https://fcm.googleapis.com/fcm/send/fSvhCA5G3qI:APA91bHST5MWANo8riM5-CutIbakIDzPNtn4pB3DbOTgEUDF6Z3flFLREtCgIcVqVjUy0QkYlUutjpJXLtfe0rKe-uf_LWSyvCcuU74kXGv8jNuGLCEuwaqDOT0VrmgWlXmdA7wr_e8h	BATr3YCR8IdAR7fQ7ZbO68DdxZvRR83iqVbB2YnHkUNQJJ-7cXfhT33qspEQugqgm8AfNgAAuJu-3qTkh07nGGw	gR664Ytdl4-mNkiQL-TJaQ	2025-12-21 02:14:51.037476	2025-12-21 02:14:51.307494	f
16	https://fcm.googleapis.com/fcm/send/fsElmDquoJ0:APA91bGSMz4wWOh5sMy5f_gVqalV1LN2gD_aUIxSRtX8blVxfSxdn9KVLs4v2uBHhAg_YCoW3GoU13TxbWMPhjkkXFJJebkWk0rFr8H939uNTM8rDjuAwaxirDXGU-3S0_xyzSWyix8x	BOZPXOJtuWSgNoE4fQwbGhEXDwgV7BmVswNesQK7YFTXDXuGmQKxMXbsaRT3WtpgagY9VvqL2rwlmTE1FIBfMxo	gukfCGGFxGvc5AyCr8whqQ	2025-12-21 02:15:35.365616	2025-12-21 02:44:23.634522	t
\.


--
-- TOC entry 3840 (class 0 OID 0)
-- Dependencies: 219
-- Name: notification_deliveries_id_seq; Type: SEQUENCE SET; Schema: public; Owner: privatoffy
--

SELECT pg_catalog.setval('public.notification_deliveries_id_seq', 5, true);


--
-- TOC entry 3841 (class 0 OID 0)
-- Dependencies: 217
-- Name: notifications_history_id_seq; Type: SEQUENCE SET; Schema: public; Owner: privatoffy
--

SELECT pg_catalog.setval('public.notifications_history_id_seq', 6, true);


--
-- TOC entry 3842 (class 0 OID 0)
-- Dependencies: 215
-- Name: subscriptions_id_seq; Type: SEQUENCE SET; Schema: public; Owner: privatoffy
--

SELECT pg_catalog.setval('public.subscriptions_id_seq', 16, true);


--
-- TOC entry 3678 (class 2606 OID 16809)
-- Name: notification_deliveries notification_deliveries_notification_id_subscription_id_key; Type: CONSTRAINT; Schema: public; Owner: privatoffy
--

ALTER TABLE ONLY public.notification_deliveries
    ADD CONSTRAINT notification_deliveries_notification_id_subscription_id_key UNIQUE (notification_id, subscription_id);


--
-- TOC entry 3680 (class 2606 OID 16807)
-- Name: notification_deliveries notification_deliveries_pkey; Type: CONSTRAINT; Schema: public; Owner: privatoffy
--

ALTER TABLE ONLY public.notification_deliveries
    ADD CONSTRAINT notification_deliveries_pkey PRIMARY KEY (id);


--
-- TOC entry 3673 (class 2606 OID 16795)
-- Name: notifications_history notifications_history_pkey; Type: CONSTRAINT; Schema: public; Owner: privatoffy
--

ALTER TABLE ONLY public.notifications_history
    ADD CONSTRAINT notifications_history_pkey PRIMARY KEY (id);


--
-- TOC entry 3667 (class 2606 OID 16784)
-- Name: subscriptions subscriptions_endpoint_key; Type: CONSTRAINT; Schema: public; Owner: privatoffy
--

ALTER TABLE ONLY public.subscriptions
    ADD CONSTRAINT subscriptions_endpoint_key UNIQUE (endpoint);


--
-- TOC entry 3669 (class 2606 OID 16782)
-- Name: subscriptions subscriptions_pkey; Type: CONSTRAINT; Schema: public; Owner: privatoffy
--

ALTER TABLE ONLY public.subscriptions
    ADD CONSTRAINT subscriptions_pkey PRIMARY KEY (id);


--
-- TOC entry 3674 (class 1259 OID 16822)
-- Name: idx_deliveries_delivered; Type: INDEX; Schema: public; Owner: privatoffy
--

CREATE INDEX idx_deliveries_delivered ON public.notification_deliveries USING btree (delivered, delivered_at);


--
-- TOC entry 3675 (class 1259 OID 16820)
-- Name: idx_deliveries_notification; Type: INDEX; Schema: public; Owner: privatoffy
--

CREATE INDEX idx_deliveries_notification ON public.notification_deliveries USING btree (notification_id);


--
-- TOC entry 3676 (class 1259 OID 16821)
-- Name: idx_deliveries_subscription; Type: INDEX; Schema: public; Owner: privatoffy
--

CREATE INDEX idx_deliveries_subscription ON public.notification_deliveries USING btree (subscription_id);


--
-- TOC entry 3670 (class 1259 OID 16796)
-- Name: idx_notifications_expires; Type: INDEX; Schema: public; Owner: privatoffy
--

CREATE INDEX idx_notifications_expires ON public.notifications_history USING btree (expires_at);


--
-- TOC entry 3671 (class 1259 OID 16797)
-- Name: idx_notifications_sent; Type: INDEX; Schema: public; Owner: privatoffy
--

CREATE INDEX idx_notifications_sent ON public.notifications_history USING btree (sent_at DESC);


--
-- TOC entry 3681 (class 2606 OID 16810)
-- Name: notification_deliveries notification_deliveries_notification_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: privatoffy
--

ALTER TABLE ONLY public.notification_deliveries
    ADD CONSTRAINT notification_deliveries_notification_id_fkey FOREIGN KEY (notification_id) REFERENCES public.notifications_history(id) ON DELETE CASCADE;


--
-- TOC entry 3682 (class 2606 OID 16815)
-- Name: notification_deliveries notification_deliveries_subscription_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: privatoffy
--

ALTER TABLE ONLY public.notification_deliveries
    ADD CONSTRAINT notification_deliveries_subscription_id_fkey FOREIGN KEY (subscription_id) REFERENCES public.subscriptions(id) ON DELETE CASCADE;


-- Completed on 2025-12-22 23:22:06 +07

--
-- PostgreSQL database dump complete
--

